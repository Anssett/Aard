<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Saturday, May 21, 2022, 10:07 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "AlgaruStudyHelper" generated by Plugin Wizard -->

<muclient>
<plugin
   name="AlgaruStudyHelper"
   author="Algaru"
   id="ad5f191b2f1e098012a78a89"
   language="Lua"
   purpose="Supplement study output with more info"
   date_written="2022-05-21 22:05:50"
   requires="5.07"
   version="1.0"
   >

</plugin>

<aliases>
  <alias
   name="study"
   match="^study($|[ ]+(.*)$)"
   regexp="y"
   enabled="y"
   sequence="100"
   script="start_study"
  >
  </alias>
  <alias
   name="study_test"
   match="^study_test$"
   regexp="y"
   enabled="y"
   sequence="100"
   script="test_colors"
  >
  </alias>
</aliases>

<triggers>
  <trigger
   enabled="y"
   match="^stop_study$"
   regexp="y"
   name="stop_study"
   send_to="10"
   sequence="100"
   omit_from_output="y"
   keep_evaluating = "y"
   script="stop_study"
  >
  </trigger>
  <trigger
   enabled="n"
   match="^(?<character>.*) (?<verb>(is|are|has|have|needs|need)) (?<damage_desc>in perfect health|a few minor scratches|showing a few grazes|bleeding lightly|some small wounds and bruises|showing a few battle scars|quite a few wounds|some big nasty wounds and scratches|some very nasty wounds|a hospital|gravely injured|at death's door)\.$"
   script="print_one_study_line"
   omit_from_output="y"
   keep_evaluating = "y"
   name="study_health_trigger"
   sequence="100"
   regexp="y"
   group="study_health_triggers"
  />
</triggers>

<script>
<![CDATA[

damage_table = {
    ["in perfect health"]                    = {["color"] = "darkgreen",     ["range"] = " 100% "},
    ["in perfect health"]                    = {["color"] = "darkgreen",     ["range"] = " 100% "},
    ["a few minor scratches"]                = {["color"] = "green",         ["range"] = "95-99%"},
    ["showing a few grazes"]                 = {["color"] = "limegreen",     ["range"] = "85-94%"},
    ["bleeding lightly"]                     = {["color"] = "lime",          ["range"] = "75-84%"},
    ["some small wounds and bruises"]        = {["color"] = "lawngreen",     ["range"] = "65-74%"},
    ["showing a few battle scars"]           = {["color"] = "greenyellow",   ["range"] = "55-64%"},
    ["quite a few wounds"]                   = {["color"] = "yellow",        ["range"] = "45-54%"},
    ["some big nasty wounds and scratches"]  = {["color"] = "orange",        ["range"] = "35-44%"},
    ["some very nasty wounds"]               = {["color"] = "darkorange",    ["range"] = "25-34%"},
    ["a hospital"]                           = {["color"] = "orangered",     ["range"] = "15-24%"},
    ["gravely injured"]                      = {["color"] = "firebrick",     ["range"] = " 5-14%"},
    ["at death's door"]                      = {["color"] = "darkred",       ["range"] = " 0-4% "}    
}

damage_order = {
    "in perfect health", 
    "a few minor scratches", 
    "showing a few grazes", 
    "bleeding lightly", 
    "some small wounds and bruises", 
    "showing a few battle scars", 
    "quite a few wounds", 
    "some big nasty wounds and scratches", 
    "some very nasty wounds", 
    "a hospital", 
    "gravely injured", 
    "at death's door"
}

default_color = "lightgray"
default_range = "????"

function start_study(name, line, args)
    Send("study " .. args[1])
    SendNoEcho("echo stop_study")
    EnableTrigger("study_health_trigger", true)  
end

function stop_study()
    EnableTrigger("study_health_trigger", false) 
end

function print_one_study_line(name, line, args)
    health_string = args.damage_desc
    color = damage_table[args.damage_desc]["color"]
    range = damage_table[args.damage_desc]["range"]
  
    ColourNote(default_color, "", "[", color, "", range, default_color, "", "] ", default_color, "", line)
end

function test_colors ()
    for _, damage in ipairs(damage_order) do
        color = damage_table[damage]["color"]
        range = damage_table[damage]["range"]
        ColourNote(default_color, "", "[", color, "", range, default_color, "", "] " .. damage)
    end
end

]]>
</script>

</muclient>
