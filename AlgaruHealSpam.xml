<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Sunday, October 24, 2021, 10:56 AM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "AlgaruHealSpam" generated by Plugin Wizard -->

<muclient>
<plugin
   name="AlgaruHealSpam"
   id="e7e3471d35c179bc37ac9e9c"
   language="Lua"
   purpose="Reduce spam from heals"
   date_written="2021-10-24 10:54:58"
   requires="5.07"
   version="1.0"
   >
   <description trim="y">
    <![CDATA[
        Reduce spam from healing!
        
        Usage: healspam [option] [parameter]
        
        Options:
        help      : display this help file
        status    : display current healspam settings
        hideheals : Hide all heal messages (yourself or others)
            - "off"     - display heal messages (default)
            - "on"      - start hiding heal messages
            - "report"  - display a heal report on tick (not functional yet)
        party        : (not implemented) display a healing summary after you cast party heal
            - off    : show all party heal messages (default)
            - brief  : summarize party heal into a single line
            - silent : suppress party heal output entirely
    ]]> 
    </description>

</plugin>

<!--  Get our standard constants -->

<include name="constants.lua"/>

<!-- Triggers to hides cast on self --> 
<triggers>
  <trigger
   enabled="n"
   omit_from_output="y"
   match="^A warm feeling fills your body. \[(?<heal_amount>[0-9]+)\][ ]*$"
   regexp="y"
   name="hide_healing"
   sequence="100"
   script="exec_hide_healing"
   group="hide_healing"
  >
  </trigger>
  <trigger
   enabled="n"
   omit_from_output="y"
   match="^You feel less tired. \[(?<heal_amount>[0-9]+)\][ ]*$"
   regexp="y"
   name="hide_refresh"
   sequence="100"
   group="hide_healing"
  >
  </trigger>
  
<!-- Triggers to hide heals cast on others --> 
  <trigger
   enabled="n"
   omit_from_output="y"
   match="^(?<heal_target>.*) feels better after your healing. \[(?<heal_amount>)\d+\)]$"
   regexp="y"
   name="capture_party_heal"
   sequence="100"
   group="hide_party_heal"
  >
  </trigger>
  <trigger
   enabled="n"
   omit_from_output="y"
   match="^(?<refresh_target>.*) feels less tired after your refreshment. \[(?<refresh_amount>)\d+\)]$"
   regexp="y"
   name="capture_party_refresh"
   sequence="100"
   group="hide_party_heal"
  >
  </trigger>
</triggers>

<aliases>
  <alias
   script="OnHelp"
   match="Healspam:help"
   enabled="y"
  >
  </alias>
  <alias
    match="^healspam[ ]+help[ ]*$"
    regexp="y"
    enabled="y"
    sequence="101"
    script="OnHelp"
    >
  </alias>
  <alias
    match="^healspam[ ]*$"
    regexp="y"
    enabled="y"
    sequence="101"
    script="OnHelp"
    >
  </alias>
  <alias
    match="^healspam[ ]+status[ ]*$"
    regexp="y"
    enabled="y"
    sequence="101"
    script="print_status"
    >
  </alias>
  <alias
    match="^healspam[ ]+hideheals[ ]*$"
    regexp="y"
    enabled="y"
    sequence="101"
    script="print_status"
    >
  </alias>
  <alias
    match="^healspam[ ]+party[ ]*$"
    regexp="y"
    enabled="y"
    sequence="101"
    script="print_status"
    >
  </alias>
  <alias
    match="^healspam[ ]+hideheals[ ]+(on|off|report)[ ]*$"
    regexp="y"
    enabled="y"
    sequence="101"
    script="set_hideheals"
    >
  </alias>
  <alias
    match="^[ ]*ph[ ]*$"
    regexp="y"
    enabled="y"
    sequence="101"
    script="cast_party_heal"
    >
  </alias>
</aliases>


<script>
<![CDATA[

function cast_party_heal ()
    Send ("cast 'party heal'")
end

function OnHelp ()
  ColourNote("magenta", "", world.GetPluginInfo (world.GetPluginID (), 3))
end

function print_status ()
    ColourNote("magenta", "", "+-----------------------------+")
    ColourNote("magenta", "", "Healspam Settings")
    ColourNote("white", "", "  Hide Heals     : " .. get_hide_status())
    ColourNote("white", "", "  Party Heals    : " .. get_party_status())
    ColourNote("magenta", "", "+-----------------------------+")
end

function get_hide_status ()
    hide_status = GetVariable("hideheals_setting") or "off"
    return hide_status
end

function get_party_status ()
    party_status = GetVariable("party_setting") or "off"
    return party_status
end

function set_hideheals(name, line, args)
    new_setting = args[1]
    ColourNote("magenta", "", "*** Setting hideheals to " .. new_setting .. ".")
    SetVariable("hideheals_setting", new_setting)
    
    if (new_setting == "on")
    then
        ColourNote("magenta", "", "*** Heals cast on you will be hidden entirely. *** ")
        EnableTriggerGroup("hide_healing", true)
    elseif (new_setting == "off")
    then
        ColourNote("magenta", "", "*** You will now see all heals. *** ")
        EnableTriggerGroup("hide_healing", false)
    elseif (new_setting == "report")
    then
        ColourNote("magenta", "", "*** Heals will be summarized on tick. *** ")
        EnableTriggerGroup("hide_healing", true)
    else
        Colournote("magenta", "", "Argument '" .. new_setting .. "' didn't make sense. Resetting to off.")
        EnableTriggerGroup("hide_healing", false)
        SetVariable("hideheals_setting", "off")
    end
    
    SaveState()
end

function exec_hide_healing (name, line, args)
    heal_amount = args.heal_amount
    
    if (GetVariable("hideheals_setting") == "report")
    then
       total_heal_amount = heal_amount
    end
end


function OnPluginEnable ()
    hide_status = get_hide_status()
    if (hide_status == "on" or hide_status == "report")
    then    
        EnableTriggerGroup("hide_healing", true)
    end
    
    party_status = get_party_status()

end

function OnPluginInstall ()
    OnPluginEnable()
end


]]>
</script>

</muclient>
